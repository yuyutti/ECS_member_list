<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" href="favicon.ico">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <title>ECS-Esports メンバーリスト</title>
    </head>
    <body style="font-size: 135%">
        <div class="container my-3 p-3 bg-body rounded">
            <table class="table">
                <thead class="sticky-top" style="background-color: #fff">
                    <tr class="text-center">
                            <th scope="col">活動名</th>
                            <th scope="col">EpicID</th>
                            <th scope="col">PR</th>
                            <th scope="col">PP</th>
                            <th scope="col">PR-ZB</th>
                            <th scope="col">PP-ZB</th>
                    </tr>
                </thead>
                <tbody id="send_data"></tbody>
            </table>
            <p id="Loading" class="text-center fs-1">Now Loading...</p>
            <p id="update"></p>
            <p id="unacquired"></p>
        </div>
        <script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    </body>
    <script>
        const queryString = window.location.search;
        const params = new URLSearchParams(queryString);
        let id = params.get('id');
        if(!id) id = 'ecs'
        if(id === "ecs"){
            $("title").text("ECS-Esports メンバーリスト")
        }
        if(id === "ecg_c"){
            $("title").text("ECG-Esports 競技部門メンバーリスト")
        }
        if(id === "ecg_n"){
            $("title").text("ECG-Esports 育成部門メンバーリスト")
        }
        else id = 'ecs'
        const req_interval = 1000;
        function req() {
            $.ajax({
                url: `/data?id=${id}`,
                type: 'GET',
                success: function(response, status, xhr) {
                    if (xhr.status === 200) {
                        $(document).ready(function() {
                            const tableBody = $('#send_data');
                            const update = $('#update')
                            const unacquired = $('#unacquired')
                            let html = '';
                            let update_html
                            let unacquired_html = '';
                            for (let i = 0; i < response.length; i++) {
                                const item = response[i];

                                html += `
                                    <tr>
                                        <td class="text-center align-middle"><a href="${item.TrackerURL}" target="_blank" rel="noopener noreferrer" class="link-info">${item.playername}</a></td>
                                        <td class="text-center">${item.EpicID}<br>${item.EpicIDmanagement}</td>
                                        <td class="text-center align-middle">${item.PowerRanking}</td>
                                        <td class="text-center align-middle">${item.powerpoint}</td>
                                        <td class="text-center align-middle">${item.PowerRankingZB}</td>
                                        <td class="text-center align-middle">${item.powerpointZB}</td>
                                    </tr>
                                `;
                                
                                if(response[i].Unacquired){
                                    unacquired_html += `
                                        <p>${item.Unacquired}</p>
                                    `
                                }

                                if (i === response.length - 1) {
                                    update_html = `
                                        <p>更新日時: ${response[0].update}</p>
                                        <br>
                                        <p>最近EpicIDが変更されたためデータが更新されていない選手</p>
                                    `;
                                }
                            }
                            $('#Loading').hide();
                            tableBody.html(html);
                            update.html(update_html);
                            unacquired.html(unacquired_html)
                        });
                    } 
                },
                error: function(xhr, status, error) {
                    if (xhr.status === 400) {
                        setTimeout(req, req_interval);
                    }
                }
            });
        }
        req()
    </script>
</html>